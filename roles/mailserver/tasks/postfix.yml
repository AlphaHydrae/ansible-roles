---
- name: yum install postfix
  action: yum pkg=postfix state=latest
- name: start postfix
  action: service name=postfix enabled=yes state=started
- name: configure postfix domain
  action: lineinfile dest=/etc/postfix/main.cf regexp=^mydomain insertafter=^#mydomain line="$postfix_domain"
  notify:
    - restart postfix
- name: configure postfix hostname
  action: lineinfile dest=/etc/postfix/main.cf regexp=^myhostname insertafter=^#myhostname line="$postfix_hostname"
  notify:
    - restart postfix
- name: configure postfix relayhost
  action: lineinfile dest=/etc/postfix/main.cf regexp=^relayhost insertafter=^#relayhost line="relayhost = [smtp.gmail.com]:587"
  notify:
    - restart postfix
- name: configure postfix smtp_use_tls
  action: lineinfile dest=/etc/postfix/main.cf regexp=^smtp_use_tls insertafter=EOF line="smtp_use_tls = yes"
  notify:
    - restart postfix
- name: configure postfix smtp_sasl_auth_enable
  action: lineinfile dest=/etc/postfix/main.cf regexp=^smtp_sasl_auth_enable insertafter=EOF line="smtp_sasl_auth_enable = yes"
  notify:
    - restart postfix
- name: configure postfix smtp_sasl_password_maps
  action: lineinfile dest=/etc/postfix/main.cf regexp=^smtp_sasl_password_maps insertafter=EOF line="smtp_sasl_password_maps = hash:/etc/postfix/sasl_passwd"
  notify:
    - restart postfix
- name: configure postfix smtp_tls_CAfile
  action: lineinfile dest=/etc/postfix/main.cf regexp=^smtp_tls_CAfile insertafter=EOF line="smtp_tls_CAfile = /etc/ssl/certs/ca-bundle.crt"
  notify:
    - restart postfix
- name: configure postfix smtp_sasl_security_options
  action: lineinfile dest=/etc/postfix/main.cf regexp=^smtp_sasl_security_options insertafter=EOF line="smtp_sasl_security_options ="
  notify:
    - restart postfix
- name: template /etc/postfix/sasl_passwd
  action: template src=sasl_passwd.j2 dest=/etc/postfix/sasl_passwd
  notify:
    - restart postfix
- name: postmap /etc/postfix/sasl_passwd
  action: command /usr/sbin/postmap /etc/postfix/sasl_passwd creates=/etc/postfix/sasl_passwd.db
  notify:
    - restart postfix
